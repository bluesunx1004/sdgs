# app.py
# ì²­ë…„ ê³ ìš© ë™í–¥ ë¶„ì„ â€“ SDGs(ëª©í‘œ 8) ìˆ˜ì—…ìš© ìŠ¤íŠ¸ë¦¼ë¦¿ ì•±
import streamlit as st
import pandas as pd
import altair as alt

st.set_page_config(page_title="ì²­ë…„ ê³ ìš© ë™í–¥ ë¶„ì„", layout="wide")

# 1) ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° & ì „ì²˜ë¦¬ --------------------------------------------------
@st.cache_data
def load_data(path: str) -> pd.DataFrame:
    df = pd.read_csv(path)
    df = df.set_index("Unnamed: 0").T           # í–‰Â·ì—´ ì „ì¹˜
    df.index.name = "ì—°ë„"
    df = df.applymap(lambda x: float(str(x).replace(",", "")))  # ìˆ«ìí˜• ë³€í™˜
    # ì¶”ê°€ ì§€í‘œ ê³„ì‚°
    df["ê³ ìš©ë¥ (%)"] = df["ì·¨ì—…ì"] / df["ê²½ì œí™œë™ì¸êµ¬"] * 100
    df["ì°¸ì—¬ìœ¨(%)"] = df["ê²½ì œí™œë™ì¸êµ¬"] / df["ìƒì‚°ê°€ëŠ¥ì¸êµ¬"] * 100
    return df.reset_index()

data = load_data("employmentrate.csv")
years = data["ì—°ë„"].astype(int)

st.title("ğŸ“ˆ ëŒ€í•œë¯¼êµ­ ì²­ë…„ ê³ ìš© ë™í–¥ (2010 â€“ 2024)")

st.markdown(
"""
**SDGs ëª©í‘œ 8**: _â€œëª¨ë‘ë¥¼ ìœ„í•œ ì§€ì†ì Â·í¬ìš©ì Â·ì§€ì†ê°€ëŠ¥í•œ ê²½ì œì„±ì¥, ì™„ì „í•˜ê³  ìƒì‚°ì ì¸ ê³ ìš©, ì–‘ì§ˆì˜ ì¼ìë¦¬ ì œê³µâ€_  
ê³ ë“±í•™ìƒ ëˆˆë†’ì´ì—ì„œ ì²­ë…„ ê³ ìš© ë°ì´í„°ë¥¼ í•´ì„í•˜ë©°, ì‚¬íšŒÂ·ê²½ì œì  ë§¥ë½ê³¼ ì§€ì†ê°€ëŠ¥ë°œì „ ëª©í‘œë¥¼ í•¨ê»˜ íƒêµ¬í•©ë‹ˆë‹¤.
"""
)

# 2) ì‚¬ì´ë“œë°” â€“ ì¸í„°ë™í‹°ë¸Œ ì„¤ì • ---------------------------------------------
st.sidebar.header("ğŸ”§ ê·¸ë˜í”„ ì˜µì…˜")
year_range = st.sidebar.slider("ì—°ë„ ë²”ìœ„ ì„ íƒ", int(years.min()), int(years.max()),
                               (2010, 2024), step=1)

metric_options = ["ìƒì‚°ê°€ëŠ¥ì¸êµ¬", "ê²½ì œí™œë™ì¸êµ¬", "ì·¨ì—…ì", "ì‹¤ì—…ì",
                  "ì‹¤ì—…ë¥ ", "ê³ ìš©ë¥ (%)", "ì°¸ì—¬ìœ¨(%)"]
metrics_to_show = st.sidebar.multiselect("í‘œì‹œí•  ì§€í‘œ", metric_options,
                                         default=["ê²½ì œí™œë™ì¸êµ¬", "ì·¨ì—…ì", "ì‹¤ì—…ë¥ "])

filtered = data[(data["ì—°ë„"] >= year_range[0]) & (data["ì—°ë„"] <= year_range[1])]

# 3) ì‹œê°í™” -------------------------------------------------------------------
st.subheader("â‘  ì—°ë„ë³„ ì£¼ìš” ì§€í‘œ ì¶”ì´")

base = alt.Chart(filtered).encode(
    x=alt.X("ì—°ë„:O", axis=alt.Axis(title=None))
)

line = base.transform_fold(
    metrics_to_show, as_=["ì§€í‘œ", "ê°’"]
).mark_line(point=True).encode(
    y=alt.Y("ê°’:Q", title="ê°’"),
    color="ì§€í‘œ:N"
)

st.altair_chart(line, use_container_width=True)

st.divider()

st.subheader("â‘¡ ê²½ì œí™œë™ì°¸ê°€ìœ¨Â·ê³ ìš©ë¥  ë¹„êµ")

rate_chart = base.transform_fold(
    ["ì°¸ì—¬ìœ¨(%)", "ê³ ìš©ë¥ (%)"], as_=["ì§€í‘œ", "ê°’"]
).mark_bar().encode(
    y=alt.Y("ê°’:Q", title="ë¹„ìœ¨(%)"),
    color="ì§€í‘œ:N"
)

st.altair_chart(rate_chart, use_container_width=True)

st.divider()

# 4) ìˆ˜ì—…ìš© ì½˜í…ì¸  ------------------------------------------------------------
with st.expander("ğŸ’¬ í•™ìƒ í† ë¡  ì§ˆë¬¸"):
    st.markdown("""
- **ì‹¤ì—…ë¥ ì´ ê°€ì¥ ë†’ì•˜ë˜ í•´**ëŠ” ì–¸ì œì´ë©°, ê·¸ ë‹¹ì‹œ ì‚¬íšŒÂ·ê²½ì œì  ìƒí™©ì€ ì–´ë• ì„ê¹Œ?  
- **ê³ ìš©ë¥ ê³¼ ì‹¤ì—…ë¥ **ì€ í•­ìƒ ë°˜ë¹„ë¡€í• ê¹Œ? ì˜ˆì™¸ê°€ ìˆë‹¤ë©´ ì´ìœ ëŠ”?  
- **ì½”ë¡œë‚˜19**(2020 ë…„ê²½)ê°€ ì²­ë…„ ê³ ìš©ì— ë¯¸ì¹œ êµ¬ì²´ì  ì˜í–¥ì€ ë¬´ì—‡ì¼ê¹Œ?  
- SDGs ëª©í‘œ 8 ê´€ì ì—ì„œ **â€˜ì–‘ì§ˆì˜ ì¼ìë¦¬â€™**ë€ ë¬´ì—‡ì´ë©°, ì²­ë…„ì¸µì—ê²Œ ì™œ ì¤‘ìš”í• ê¹Œ?
""")

with st.expander("ğŸ“ êµìœ¡ì  í•¨ì˜"):
    st.markdown("""
1. **ìë£Œ í•´ì„ë ¥ ê°•í™”** â€“ ì‹¤ì œ êµ­ê°€ í†µê³„ ì½ê¸°Â·ê·¸ë˜í”„ í•´ì„ì„ í†µí•´ ìˆ˜ë¦¬ì  ì‚¬ê³  í–¥ìƒ  
2. **ì‚¬íšŒ êµ¬ì¡° ì´í•´** â€“ ì²­ë…„ ì‹¤ì—…Â·ê³ ìš© ë³€í™”ë¥¼ ê²½ì œÂ·ì •ì±…ê³¼ ì—°ê²°  
3. **ì§€ì†ê°€ëŠ¥ì„± ê´€ì ** â€“ ë°ì´í„° ê¸°ë°˜ìœ¼ë¡œ â€˜í¬ìš©ì â€§ì§€ì†ê°€ëŠ¥í•œ ì„±ì¥â€™ì˜ í•„ìš”ì„± ëª¨ìƒ‰  
4. **ë¹„íŒì  ì‚¬ê³ ** â€“ ì§€í‘œ ê°„ ì¸ê³¼(í˜¹ì€ ìƒê´€) ê´€ê³„ë¥¼ ë¹„íŒì ìœ¼ë¡œ ë¶„ì„
""")

with st.expander("ğŸš€ í™•ì¥ í™œë™"):
    st.markdown("""
- **ì§€ì—­ë³„Â·ì„±ë³„ ë°ì´í„° ì¶”ê°€** â†’ ì§€ì—­ ê²©ì°¨Â·ì  ë” ê´€ì  ë¶„ì„  
- ê³¼ê±° ì¶”ì„¸ë¡œ **ë¯¸ë˜ ê³ ìš©ë¥  ì˜ˆì¸¡** â†’ ì„ í˜• íšŒê·€ ë“± ê°„ë‹¨í•œ ML ëª¨ë¸ ì‹¤ìŠµ  
- **ì²­ë…„ ì¸í„°ë·° í”„ë¡œì íŠ¸** â†’ í†µê³„ ìˆ˜ì¹˜ì™€ ì‹¤ì œ ê²½í—˜ ë¹„êµ  
- ê´€ë ¨ **ì •ì±… ì œì•ˆì„œ ì‘ì„±** â†’ ë°ì´í„°ë¥¼ ê·¼ê±°ë¡œ ì²­ë…„ ê³ ìš© ê°œì„  ë°©ì•ˆ ì œì‹œ
""")

st.info("ë°ì´í„° ì¶œì²˜: í†µê³„ì²­ ì²­ë…„ ê³ ìš© ë™í–¥ (2010â€“2024)  |  Â© 2025, êµìœ¡ìš© ì˜ˆì‹œ ìŠ¤í¬ë¦½íŠ¸")

# pages/07_07_birth_rate_korea.py
import streamlit as st
import pandas as pd
import plotly.express as px
import os

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ í˜ì´ì§€ ì„¤ì • â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
st.set_page_config(page_title="ğŸ‡°ğŸ‡· ì¶œìƒì•„ ìˆ˜ ë¶„ì„", layout="wide")
st.title("ğŸ‘¶ ëŒ€í•œë¯¼êµ­ ì¶œìƒì•„ ìˆ˜ ì‹œê°í™” (SDG 3, 11)")

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ë°ì´í„° ë¡œë“œ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
def read_csv(name):
    path = os.path.join(os.path.dirname(__file__), "..", name)
    if os.path.exists(path):
        return pd.read_csv(path)
    upl = st.file_uploader(f"â¬†ï¸ {name} ì—…ë¡œë“œ", type="csv", key=name)
    if upl is not None:
        return pd.read_csv(upl)
    st.stop()

df = read_csv("born baby2.csv")   # íŒŒì¼ëª…ì€ ì •í™•íˆ ë™ì¼í•˜ê²Œ

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ì „ì²˜ë¦¬ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ë¶ˆí•„ìš”í•œ ì—´ ì œê±°
if 'Unnamed: 0' in df.columns:
    df = df.drop(columns=['Unnamed: 0'])

# ì»¬ëŸ¼ëª… ì •ë¦¬
if len(df.columns) == 2:
    df.columns = ["ì—°ë„", "ì¶œìƒì•„ìˆ˜(ì²œ ëª…)"]

# ìˆ«ìí˜• ë³€í™˜
df["ì—°ë„"] = pd.to_numeric(df["ì—°ë„"], errors="coerce")
df["ì¶œìƒì•„ìˆ˜(ì²œ ëª…)"] = pd.to_numeric(df["ì¶œìƒì•„ìˆ˜(ì²œ ëª…)"], errors="coerce")
df = df.dropna()

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ì¶œìƒì•„ ìˆ˜ ì¶”ì„¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
st.markdown("### ğŸ“ˆ ì¶œìƒì•„ ìˆ˜ ë³€í™” ì¶”ì´")

fig_birth = px.line(df, x="ì—°ë„", y="ì¶œìƒì•„ìˆ˜(ì²œ ëª…)",
                    markers=True,
                    title="ì—°ë„ë³„ ì¶œìƒì•„ ìˆ˜ ì¶”ì´ (ì²œ ëª… ë‹¨ìœ„)",
                    labels={"ì¶œìƒì•„ìˆ˜(ì²œ ëª…)": "ì¶œìƒì•„ ìˆ˜ (ì²œ ëª…)", "ì—°ë„": "ì—°ë„"})
fig_birth.update_layout(title_font_size=18)
st.plotly_chart(fig_birth, use_container_width=True)

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ìµœê·¼ ì—°ë„ ê°•ì¡° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
st.markdown("### ğŸ“Š íŠ¹ì • ì—°ë„ì˜ ì¶œìƒì•„ ìˆ˜")

sel_year = st.slider("ì—°ë„ ì„ íƒ", int(df["ì—°ë„"].min()), int(df["ì—°ë„"].max()), int(df["ì—°ë„"].max()))
selected = df[df["ì—°ë„"] == sel_year]

if not selected.empty:
    count = selected["ì¶œìƒì•„ìˆ˜(ì²œ ëª…)"].values[0]
    st.metric(label=f"{sel_year}ë…„ ì¶œìƒì•„ ìˆ˜", value=f"{count:,.0f}ì²œ ëª…")

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ë°ì´í„° ë¯¸ë¦¬ë³´ê¸° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
with st.expander("ğŸ” ì›ë³¸ ë°ì´í„° ë³´ê¸°"):
    st.dataframe(df)

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ SDG ì—°ê³„ & êµìœ¡ ìš”ì†Œ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
st.markdown("### ğŸ’¬ í•™ìƒ í† ë¡  ì§ˆë¬¸")
st.markdown("""
1. ì¶œìƒì•„ ìˆ˜ê°€ ì§€ì†ì ìœ¼ë¡œ ê°ì†Œí•˜ëŠ” ì›ì¸ì€ ë¬´ì—‡ì´ë¼ê³  ìƒê°í•˜ë‚˜ìš”?  
2. ì¶œìƒë¥  ê°ì†Œê°€ ì‚¬íšŒì— ë¯¸ì¹˜ëŠ” ì˜í–¥ì€ ì–´ë–¤ ê²ƒì´ ìˆì„ê¹Œìš”?  
3. **SDG 3 'ê±´ê°•ê³¼ ì›°ë¹™'**, **SDG 11 'ì§€ì†ê°€ëŠ¥í•œ ë„ì‹œì™€ ê³µë™ì²´'** ê´€ì ì—ì„œ ì–´ë–¤ ì •ì±…ì´ í•„ìš”í• ê¹Œìš”?
""")

st.markdown("### ğŸ“š êµìœ¡ì  í•¨ì˜")
st.markdown("""
- **ì¸êµ¬í†µê³„ ë°ì´í„° í•´ì„**: ì¶œìƒë¥  ë³€í™”ë¥¼ ìˆ˜ì¹˜ë¡œ ì´í•´í•˜ê³  ì‚¬íšŒì  ì˜ë¯¸ë¥¼ íŒŒì•…  
- **ì§€ì†ê°€ëŠ¥ì„± ì´í•´**: ì¶œì‚°ìœ¨ê³¼ ë³µì§€Â·êµìœ¡Â·ì£¼ê±° ë“± ë‹¤ì–‘í•œ ë¶„ì•¼ì˜ ì—°ê²°ì„± ë¶„ì„  
- **ë¯¸ë˜ ì˜ˆì¸¡**: ë°ì´í„° ê¸°ë°˜ ì¸êµ¬ êµ¬ì¡° ë³€í™” ì˜ˆì¸¡ ë° ëŒ€ì‘ ë°©í–¥ ë…¼ì˜
""")

st.markdown("### ğŸš€ í™•ì¥ í™œë™")
st.markdown("""
- **ì§€ì—­ë³„ ì¶œìƒë¥  ì¡°ì‚¬**: ìš°ë¦¬ ì§€ì—­ê³¼ ë‹¤ë¥¸ ì§€ì—­ì˜ ì¶œìƒë¥  ì°¨ì´ ë¹„êµ  
- **ì²­ì†Œë…„ ì¸ì‹ ì¡°ì‚¬**: ê²°í˜¼Â·ì¶œì‚°ì— ëŒ€í•œ ë˜ë˜ ì¸ì‹ ì„¤ë¬¸ í›„ ë¶„ì„  
- **êµ­ì œ ë¹„êµ ë¶„ì„**: ì €ì¶œì‚° êµ­ê°€ vs ê³ ì¶œì‚° êµ­ê°€ ì •ì±… ë¹„êµ ë° ì‹œì‚¬ì  ë„ì¶œ
""")

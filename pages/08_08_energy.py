# pages/08_08_energy.py
import streamlit as st
import pandas as pd
import plotly.express as px
import os

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ í˜ì´ì§€ ì„¤ì • â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
st.set_page_config(page_title="âš¡ ì—ë„ˆì§€ì›ë³„ ë°œì „ëŸ‰ ë¶„ì„", layout="wide")
st.title("âš¡ ìš°ë¦¬ë‚˜ë¼ ì—ë„ˆì§€ì›ë³„ ë°œì „ëŸ‰ ë¶„ì„ (SDG 7)")

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ë°ì´í„° ë¡œë“œ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
def read_csv(name):
    path = os.path.join(os.path.dirname(__file__), "..", name)
    if os.path.exists(path):
        return pd.read_csv(path)
    upl = st.file_uploader(f"â¬†ï¸ {name} ì—…ë¡œë“œ", type="csv", key=name)
    if upl is not None:
        return pd.read_csv(upl)
    st.stop()

df = read_csv("energy.csv")  # ì—°ë„, ì—ë„ˆì§€ì›, ë°œì „ëŸ‰(ê¸°ê°€ì™€íŠ¸ì‹œ)

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ì „ì²˜ë¦¬ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
df = df.dropna()
df.columns = df.columns.str.strip()
df["ì—°ë„"] = df["ì—°ë„"].astype(int)
df["ë°œì „ëŸ‰"] = pd.to_numeric(df["ë°œì „ëŸ‰"], errors="coerce")
df = df.dropna()

# ë°œì „ ë¹„ì¤‘ ê³„ì‚°
total_by_year = df.groupby("ì—°ë„")["ë°œì „ëŸ‰"].sum().reset_index(name="ì´ë°œì „ëŸ‰")
rate_df = df.merge(total_by_year, on="ì—°ë„")
rate_df["ë¹„ì¤‘"] = (rate_df["ë°œì „ëŸ‰"] / rate_df["ì´ë°œì „ëŸ‰"]) * 100

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ë°œì „ëŸ‰ ì¶”ì„¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
st.markdown("### ğŸ“ˆ ì—ë„ˆì§€ì›ë³„ ë°œì „ëŸ‰ ì¶”ì„¸")

all_sources = sorted(df["ì—ë„ˆì§€ì›"].unique())
sel_sources = st.multiselect("í™•ì¸í•  ì—ë„ˆì§€ì› ì„ íƒ", all_sources,
                             default=["ì„íƒ„", "ì²œì—°ê°€ìŠ¤", "ì‹ ì¬ìƒ"])
plot_df = df[df["ì—ë„ˆì§€ì›"].isin(sel_sources)]

fig1 = px.line(plot_df, x="ì—°ë„", y="ë°œì „ëŸ‰", color="ì—ë„ˆì§€ì›",
               markers=True,
               labels={"ë°œì „ëŸ‰": "ë°œì „ëŸ‰(GWh)"},
               title="ì—ë„ˆì§€ì›ë³„ ë°œì „ëŸ‰ ë³€í™”")
fig1.update_layout(title_font_size=18, legend_title_text="ì—ë„ˆì§€ì›")
st.plotly_chart(fig1, use_container_width=True)

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ë°œì „ ë¹„ì¤‘ ì¶”ì„¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
st.markdown("### ğŸ“Š ì—ë„ˆì§€ì›ë³„ ë°œì „ ë¹„ì¤‘ ì¶”ì„¸")

# ê¸°ë³¸ê°’ìœ¼ë¡œ ì¡´ì¬í•˜ëŠ” í•­ëª©ë§Œ ì„ íƒ
available_sources = sorted(rate_df["ì—ë„ˆì§€ì›"].dropna().unique())
default_sources = [src for src in ["ì›ìë ¥", "ì„íƒ„", "ì‹ ì¬ìƒ"] if src in available_sources]

sel_sources2 = st.multiselect("ë¹„ì¤‘ í™•ì¸ ì—ë„ˆì§€ì›", available_sources,
                              default=default_sources)
plot_rate = rate_df[rate_df["ì—ë„ˆì§€ì›"].isin(sel_sources2)]

fig2 = px.line(plot_rate, x="ì—°ë„", y="ë¹„ì¤‘", color="ì—ë„ˆì§€ì›",
               markers=True,
               labels={"ë¹„ì¤‘": "ë°œì „ ë¹„ì¤‘(%)"},
               title="ì—ë„ˆì§€ì›ë³„ ë°œì „ ë¹„ì¤‘ ë³€í™”")
fig2.update_layout(title_font_size=18, legend_title_text="ì—ë„ˆì§€ì›")
st.plotly_chart(fig2, use_container_width=True)

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ë°ì´í„° ë¯¸ë¦¬ë³´ê¸° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
with st.expander("ğŸ” ì›ë³¸ ë°ì´í„° ë³´ê¸°"):
    st.dataframe(df.head())

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ SDGs ì—°ê³„ ì½˜í…ì¸  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
st.markdown("### ğŸ’¬ í•™ìƒ í† ë¡  ì§ˆë¬¸")
st.markdown("""
1. ìš°ë¦¬ë‚˜ë¼ì—ì„œ **ê°€ì¥ ë§ì´ ì‚¬ìš©ë˜ëŠ” ì—ë„ˆì§€ì›**ì€ ë¬´ì—‡ì¸ê°€ìš”?  
2. ë°œì „ ë¹„ì¤‘ì´ **ì¤„ì–´ë“œëŠ” ì—ë„ˆì§€ì›**ê³¼ **ëŠ˜ì–´ë‚˜ëŠ” ì—ë„ˆì§€ì›**ì€ ë¬´ì—‡ì¸ê°€ìš”?  
3. **SDG 7 'Affordable and Clean Energy'** ë‹¬ì„±ì„ ìœ„í•´ ì–´ë–¤ ì—ë„ˆì§€ì›ì´ í™•ëŒ€ë˜ì–´ì•¼ í• ê¹Œìš”?
""")

st.markdown("### ğŸ“š êµìœ¡ì  í•¨ì˜")
st.markdown("""
- **ë°ì´í„° ê¸°ë°˜ í™˜ê²½ ë¶„ì„**: ì—ë„ˆì§€ ìƒì‚° ë°©ì‹ì— ë”°ë¥¸ ì‚¬íšŒÂ·í™˜ê²½ì  ì˜í–¥ ì´í•´  
- **ì—ë„ˆì§€ ì „í™˜ ì •ì±… íƒêµ¬**: êµ­ê°€ë³„ ì—ë„ˆì§€ ì „ëµê³¼ SDGs ëª©í‘œì˜ ì—°ê³„ì„± ê³ ì°°  
- **ê³¼í•™-ì‚¬íšŒ ìœµí•© í•™ìŠµ**: ì§€ì†ê°€ëŠ¥í•œ ê³¼í•™ ê¸°ìˆ ê³¼ ì •ì±…ì˜ ìƒí˜¸ì‘ìš© í•™ìŠµ
""")

st.markdown("### ğŸš€ í™•ì¥ í™œë™")
st.markdown("""
- **ì§€ì—­ ì—ë„ˆì§€ ì¡°ì‚¬**: ì§€ì—­ ë‚´ íƒœì–‘ê´‘, í’ë ¥ ë“± ì‹ ì¬ìƒ ì—ë„ˆì§€ ì‹œì„¤ í˜„í™© ì¡°ì‚¬  
- **êµ­ì œ ë¹„êµ ë¶„ì„**: ë‹¤ë¥¸ ë‚˜ë¼ì˜ ì—ë„ˆì§€ ë¯¹ìŠ¤ ë° íƒ„ì†Œ ë°°ì¶œê³¼ì˜ ìƒê´€ê´€ê³„ íƒìƒ‰  
- **ë¯¸ë˜ ì—ë„ˆì§€ ì œì•ˆ**: ìš°ë¦¬ ì‚¬íšŒê°€ ì¶”êµ¬í•´ì•¼ í•  ë¯¸ë˜ ì—ë„ˆì§€ êµ¬ì„±ì„ ë°ì´í„°ë¡œ ì„¤ê³„
""")

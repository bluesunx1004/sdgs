# pages/08_08_energy_production.py
import streamlit as st
import pandas as pd
import plotly.express as px
import os

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ í˜ì´ì§€ ì„¤ì • â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
st.set_page_config(page_title="ğŸ”‹ ì—ë„ˆì§€ì›ë³„ ë°œì „ëŸ‰ ë³€í™”", layout="wide")
st.title("ğŸ”‹ ìš°ë¦¬ë‚˜ë¼ ì—ë„ˆì§€ì›ë³„ ë°œì „ëŸ‰ ë° ë¹„ì¤‘ ë³€í™” (SDG 7)")

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ë°ì´í„° ë¡œë“œ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
def read_csv(name):
    path = os.path.join(os.path.dirname(__file__), "..", name)
    if os.path.exists(path):
        return pd.read_csv(path)
    upl = st.file_uploader(f"â¬†ï¸ {name} ì—…ë¡œë“œ", type="csv", key=name)
    if upl is not None:
        return pd.read_csv(upl)
    st.stop()

df = read_csv("energy.csv")

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ë°ì´í„° ì „ì²˜ë¦¬ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
df.columns = ["ì—°ë„", "êµ¬ë¶„", "ê³„", "ì›ìë ¥", "ì„íƒ„", "LNG", "ì‹ ì¬ìƒ", "ìœ ë¥˜", "ì–‘ìˆ˜", "ê¸°íƒ€"]
df = df.dropna(subset=["ì—°ë„"])
df["ì—°ë„"] = df["ì—°ë„"].astype(int)
long_df = df.melt(id_vars=["ì—°ë„", "êµ¬ë¶„"], var_name="ì—ë„ˆì§€ì›", value_name="ê°’")

# ë°œì „ëŸ‰ ë°ì´í„°ì™€ ë¹„ì¤‘ ë°ì´í„°ë¡œ ë‚˜ëˆ„ê¸°
gen_df = long_df[long_df["êµ¬ë¶„"] == "ë°œì „ëŸ‰"]
rate_df = long_df[long_df["êµ¬ë¶„"] == "ë¹„ì¤‘"]

# ìˆ˜ì¹˜í˜•ìœ¼ë¡œ ë³€í™˜ (ì²œ ë‹¨ìœ„ ì½¤ë§ˆ ì œê±°)
def to_numeric(series):
    return pd.to_numeric(series.astype(str).str.replace(",", ""), errors="coerce")

gen_df["ê°’"] = to_numeric(gen_df["ê°’"])
rate_df["ê°’"] = to_numeric(rate_df["ê°’"])

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ì‹œê°í™”: ë°œì „ëŸ‰ ë³€í™” â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
st.markdown("### ğŸ“Š ì—ë„ˆì§€ì›ë³„ ë°œì „ëŸ‰ ì¶”ì„¸")

sel_sources = st.multiselect("ì—ë„ˆì§€ì› ì„ íƒ", gen_df["ì—ë„ˆì§€ì›"].unique(),
                             default=["ì›ìë ¥", "ì„íƒ„", "LNG", "ì‹ ì¬ìƒ"])
plot_gen = gen_df[gen_df["ì—ë„ˆì§€ì›"].isin(sel_sources)]

fig_gen = px.line(plot_gen, x="ì—°ë„", y="ê°’", color="ì—ë„ˆì§€ì›",
                  markers=True, labels={"ê°’": "ë°œì „ëŸ‰ (GWh)"},
                  title="ì—ë„ˆì§€ì›ë³„ ë°œì „ëŸ‰ ì¶”ì„¸")
fig_gen.update_layout(title_font_size=18)
st.plotly_chart(fig_gen, use_container_width=True)

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ì‹œê°í™”: ì—ë„ˆì§€ì› ë¹„ì¤‘ ë³€í™” â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
st.markdown("### ğŸ“ˆ ì—ë„ˆì§€ì›ë³„ ë¹„ì¤‘(%) ë³€í™”")

sel_sources2 = st.multiselect("ë¹„ì¤‘ í™•ì¸ ì—ë„ˆì§€ì›", rate_df["ì—ë„ˆì§€ì›"].unique(),
                              default=["ì›ìë ¥", "ì„íƒ„", "ì‹ ì¬ìƒ"])
plot_rate = rate_df[rate_df["ì—ë„ˆì§€ì›"].isin(sel_sources2)]

fig_rate = px.line(plot_rate, x="ì—°ë„", y="ê°’", color="ì—ë„ˆì§€ì›",
                   markers=True, labels={"ê°’": "ë¹„ì¤‘ (%)"},
                   title="ì—ë„ˆì§€ì›ë³„ ë¹„ì¤‘ ë³€í™”")
fig_rate.update_layout(title_font_size=18)
st.plotly_chart(fig_rate, use_container_width=True)

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ SDG ì—°ê³„ ë° êµìœ¡ ìš”ì†Œ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
st.markdown("### ğŸ’¬ í•™ìƒ í† ë¡  ì§ˆë¬¸")
st.markdown("""
1. ìš°ë¦¬ë‚˜ë¼ì—ì„œ **ì‹ ì¬ìƒ ì—ë„ˆì§€ ë¹„ì¤‘**ì€ ì–´ë–»ê²Œ ë³€í™”í•´ ì™”ë‚˜ìš”?  
2. ì—¬ì „íˆ **ì„íƒ„ ë°œì „** ë¹„ì¤‘ì´ í° ì´ìœ ëŠ” ë¬´ì—‡ì¼ê¹Œìš”?  
3. **SDG 7 â€˜ì—ë„ˆì§€ì˜ ì§€ì†ê°€ëŠ¥ì„± í™•ë³´â€™**ë¥¼ ë‹¬ì„±í•˜ê¸° ìœ„í•´ ì–´ë–¤ ë³€í™”ê°€ í•„ìš”í• ê¹Œìš”?
""")

st.markdown("### ğŸ“š êµìœ¡ì  í•¨ì˜")
st.markdown("""
- **ì—ë„ˆì§€ ì „í™˜ ì´í•´**: ì—ë„ˆì§€ì›ì˜ ë³€í™” ì¶”ì´ë¥¼ í†µí•´ ì§€ì†ê°€ëŠ¥í•œ ì—ë„ˆì§€ í•„ìš”ì„± ì´í•´  
- **ë°ì´í„° ê¸°ë°˜ ì‚¬ê³ ë ¥**: ìˆ˜ì¹˜ ë³€í™”ì—ì„œ ì •ì±…ì  íë¦„ì´ë‚˜ í™˜ê²½ ì˜í–¥ì„ ìœ ì¶”  
- **SDGs í†µí•©ì  ì ‘ê·¼**: ëª©í‘œ 7ê³¼ ëª©í‘œ 13(ê¸°í›„ë³€í™” ëŒ€ì‘) ë“±ê³¼ì˜ ì—°ê³„ í•™ìŠµ
""")

st.markdown("### ğŸš€ í™•ì¥ í™œë™")
st.markdown("""
- **ì§€ì—­ ì¡°ì‚¬ í™œë™**: ì§€ì—­ ë‚´ íƒœì–‘ê´‘/í’ë ¥/ì‹ ì¬ìƒ ì‹œì„¤ íƒë°©  
- **ìº í˜ì¸ ë””ìì¸**: ì—ë„ˆì§€ ì ˆì•½ ë° ì „í™˜ì„ ìœ„í•œ í¬ìŠ¤í„°Â·ì˜ìƒ ì œì‘  
- **ì •ì±… ì œì•ˆì„œ ì‘ì„±**: í•™ìƒ ê´€ì ì—ì„œ ì§€ì† ê°€ëŠ¥í•œ ì—ë„ˆì§€ ì •ì±… ì œì•ˆì„œ ì‘ì„±
""")

with st.expander("ğŸ” ì›ë³¸ ë°ì´í„° ë¯¸ë¦¬ë³´ê¸°"):
    st.dataframe(df)

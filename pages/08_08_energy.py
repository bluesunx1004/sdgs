# pages/08_08_energy.py

import streamlit as st
import pandas as pd
import plotly.express as px
import os

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ í˜ì´ì§€ ì„¤ì • â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
st.set_page_config(page_title="ğŸ‡°ğŸ‡· ì—ë„ˆì§€ì›ë³„ ë¹„ì¤‘ ë¶„ì„", layout="wide")
st.title("ğŸ”‹ ìš°ë¦¬ë‚˜ë¼ ì—ë„ˆì§€ì›ë³„ ë°œì „ ë¹„ì¤‘ ë¶„ì„ (SDG 7)")

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
def read_csv(name):
    path = os.path.join(os.path.dirname(__file__), "..", name)
    if os.path.exists(path):
        return pd.read_csv(path)
    upl = st.file_uploader(f"â¬†ï¸ {name} ì—…ë¡œë“œ", type="csv", key=name)
    if upl is not None:
        return pd.read_csv(upl)
    st.stop()

df = read_csv("energy.csv")
df.columns = df.columns.str.strip()
df["ì—°ë„"] = df["ì—°ë„"].astype(int)

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ë°ì´í„° ë³€í™˜ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
df_long = df.melt(id_vars="ì—°ë„", var_name="ì—ë„ˆì§€ì›", value_name="ë¹„ìœ¨(%)")

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ë¹„ì¤‘ ì¶”ì„¸ ê·¸ë˜í”„ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
st.markdown("### ğŸ“ˆ ì—ë„ˆì§€ì›ë³„ ë¹„ì¤‘ ë³€í™” ì¶”ì„¸")
sources = sorted(df_long["ì—ë„ˆì§€ì›"].unique())
sel_sources = st.multiselect("ë¶„ì„í•  ì—ë„ˆì§€ì› ì„ íƒ", sources, default=sources)

plot_df = df_long[df_long["ì—ë„ˆì§€ì›"].isin(sel_sources)]
fig = px.line(plot_df, x="ì—°ë„", y="ë¹„ìœ¨(%)", color="ì—ë„ˆì§€ì›", markers=True,
              title="ì—ë„ˆì§€ì›ë³„ ë°œì „ ë¹„ì¤‘ ë³€í™”",
              labels={"ì—°ë„": "ì—°ë„", "ë¹„ìœ¨(%)": "ë¹„ì¤‘ (%)"})
fig.update_layout(title_font_size=18, legend_title_text="ì—ë„ˆì§€ì›")
st.plotly_chart(fig, use_container_width=True)

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ íŠ¹ì • ì—°ë„ ë¹„êµ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
st.markdown("### ğŸ“Š íŠ¹ì • ì—°ë„ë³„ ì—ë„ˆì§€ì› ë¹„ì¤‘")
sel_year = st.slider("ì—°ë„ ì„ íƒ", int(df["ì—°ë„"].min()), int(df["ì—°ë„"].max()), int(df["ì—°ë„"].max()))
year_df = df[df["ì—°ë„"] == sel_year].drop(columns="ì—°ë„").T.reset_index()
year_df.columns = ["ì—ë„ˆì§€ì›", "ë¹„ìœ¨(%)"]

bar_fig = px.bar(year_df, x="ì—ë„ˆì§€ì›", y="ë¹„ìœ¨(%)", text="ë¹„ìœ¨(%)",
                 title=f"{sel_year}ë…„ ì—ë„ˆì§€ì›ë³„ ë¹„ì¤‘")
bar_fig.update_traces(texttemplate='%{text:.1f}%', textposition='outside')
bar_fig.update_layout(yaxis_range=[0, max(year_df["ë¹„ìœ¨(%)"]) + 10])
st.plotly_chart(bar_fig, use_container_width=True)

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ë°ì´í„° ë¯¸ë¦¬ë³´ê¸° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
with st.expander("ğŸ” ì›ë³¸ ë°ì´í„° ë³´ê¸°"):
    st.dataframe(df)

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ SDG ì—°ê³„ ë° ìˆ˜ì—… ìš”ì†Œ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
st.markdown("### ğŸ’¬ í•™ìƒ í† ë¡  ì§ˆë¬¸")
st.markdown("""
1. ì–´ë–¤ ì—ë„ˆì§€ì›ì´ ì‹œê°„ì´ ì§€ë‚¨ì— ë”°ë¼ **ì¦ê°€í•˜ê±°ë‚˜ ê°ì†Œ**í–ˆë‚˜ìš”?  
2. **ì‹ ì¬ìƒì—ë„ˆì§€ì˜ ë¹„ì¤‘**ì€ ì¶©ë¶„í•˜ë‹¤ê³  ìƒê°í•˜ë‚˜ìš”? ì™œ ê·¸ëŸ°ê°€ìš”?  
3. **íƒ„ì†Œì¤‘ë¦½ ì‚¬íšŒ**ë¡œ ì „í™˜í•˜ê¸° ìœ„í•´ ì–´ë–¤ ì—ë„ˆì§€ì›ì˜ í™•ëŒ€ê°€ í•„ìš”í• ê¹Œìš”?
""")

st.markdown("### ğŸ“š êµìœ¡ì  í•¨ì˜")
st.markdown("""
- **ì‹œê³„ì—´ ë°ì´í„° ë¶„ì„**ì„ í†µí•´ ì‚¬íšŒ ë³€í™” ê´€ì°°  
- **ì—ë„ˆì§€ ì •ì±…**ì˜ ë°©í–¥ì„±ê³¼ SDG 7(ëª¨ë‘ë¥¼ ìœ„í•œ ì—ë„ˆì§€)ì˜ ì—°ê²°  
- **ê¸°í›„ë³€í™” ëŒ€ì‘**ì„ ìœ„í•œ ì—ë„ˆì§€ ì „í™˜ ì´í•´
""")

st.markdown("### ğŸš€ í™•ì¥ í™œë™")
st.markdown("""
- **ì§€ì—­ë³„ ì—ë„ˆì§€ ì‚¬ìš© ì‹¤íƒœ ì¡°ì‚¬ ë° ë°œí‘œ**  
- **êµ­ê°€ ê°„ ì—ë„ˆì§€ì› ë¹„ì¤‘ ë¹„êµ ë¶„ì„**  
- **ë¯¸ë˜ ì—ë„ˆì§€ í¬íŠ¸í´ë¦¬ì˜¤ ì œì•ˆì„œ ì‘ì„±**
""")
